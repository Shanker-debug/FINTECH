<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TRUSTID | Audit Log</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-dark: #0B2C4A;
            --primary-blue: #114E82;
            --accent-blue: #1F75FE;
            --light-blue: #3FA9F5;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-blue));
            color: white;
        }

        .navbar {
            padding: 20px 40px;
        }

        .card-custom {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            color: white;
        }

        .list-group-item {
            background: rgba(255,255,255,0.05);
            border: none;
            color: white;
            margin-bottom: 10px;
            border-radius: 15px;
        }

        .btn-primary {
            background: var(--accent-blue);
            border: none;
        }

        .btn-primary:hover {
            background: var(--light-blue);
        }

        .badge-custom {
            background: var(--light-blue);
            color: white;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <span class="navbar-brand text-white fw-bold">TRUSTID Audit Trail</span>
        <a href="index.html" class="btn btn-outline-light btn-sm">Dashboard</a>
    </div>
</nav>

<div class="container mt-5">

    <div class="card card-custom p-4">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">üìú Audit Trail</h4>
            <span class="badge badge-custom" id="logCount">0 Records</span>
        </div>

        <p class="opacity-75">
            This log tracks every time your KYC vault data was accessed via Auto-Fill.
            Ensures transparency, integrity, and compliance.
        </p>

        <ul id="logList" class="list-group mb-4"></ul>

        <div class="d-flex flex-wrap gap-2">
            <button class="btn btn-primary" onclick="addAuditLog()">Simulate Auto-Fill</button>
            <button class="btn btn-success" onclick="verifyIntegrity()">Verify Integrity</button>
            <button class="btn btn-danger" onclick="clearLogs()">Clear Logs</button>
        </div>

    </div>

</div>

<script>

// ================= SIMPLE HASH FUNCTION =================
function generateSimpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash |= 0;
    }
    return hash.toString();
}

// ================= ADD AUDIT LOG =================
function addAuditLog() {

    const logs = JSON.parse(localStorage.getItem("auditLogs")) || [];
    const previousHash = logs.length > 0 ? logs[logs.length - 1].currentHash : "GENESIS";

    const now = new Date();

    const logEntry = {
        logId: Date.now(),
        userId: "admin",
        service: "TRUSTID Auto-Fill",
        action: "KYC_AUTO_FILL",
        consentId: "CONSENT" + Math.floor(Math.random()*1000),
        date: now.toLocaleDateString("en-IN"),
        time: now.toLocaleTimeString("en-IN"),
        device: navigator.userAgent,
        previousHash: previousHash
    };

    logEntry.currentHash = generateSimpleHash(JSON.stringify(logEntry));

    logs.push(logEntry);
    localStorage.setItem("auditLogs", JSON.stringify(logs));

    loadLogs();
}

// ================= LOAD LOGS =================
function loadLogs() {

    const logs = JSON.parse(localStorage.getItem("auditLogs")) || [];
    const list = document.getElementById("logList");
    const count = document.getElementById("logCount");

    list.innerHTML = "";
    count.innerText = logs.length + " Records";

    if (logs.length === 0) {
        list.innerHTML = "<li class='list-group-item text-muted'>No audit records found.</li>";
        return;
    }

    logs.forEach((log) => {

        const li = document.createElement("li");
        li.className = "list-group-item";

        li.innerHTML = `
            <div class="fw-bold">üîé ${log.action}</div>
            <small>
                üë§ User: ${log.userId}<br>
                üè¢ Service: ${log.service}<br>
                üìú Consent ID: ${log.consentId}<br>
                üìÖ Date: ${log.date}<br>
                ‚è∞ Time: ${log.time}<br>
                üîê Hash: ${log.currentHash}
            </small>
        `;

        list.appendChild(li);
    });
}

// ================= VERIFY INTEGRITY =================
function verifyIntegrity() {

    const logs = JSON.parse(localStorage.getItem("auditLogs")) || [];

    for (let i = 1; i < logs.length; i++) {
        if (logs[i].previousHash !== logs[i - 1].currentHash) {
            alert("‚ö† Tampering Detected in Audit Logs!");
            return;
        }
    }

    alert("‚úî Audit Trail Integrity Verified");
}

// ================= CLEAR LOGS =================
function clearLogs() {
    if (confirm("Are you sure you want to clear all audit logs?")) {
        localStorage.removeItem("auditLogs");
        loadLogs();
    }
}

loadLogs();

</script>
<script>
if (localStorage.getItem("isLoggedIn") !== "true") {
    window.location.replace("login.html");
}
</script>

</body>
</html>